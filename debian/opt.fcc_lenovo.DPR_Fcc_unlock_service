abi <abi/3.0>,

include <tunables/global>

/opt/fcc_lenovo/DPR_Fcc_unlock_service {
  include <abstractions/base>
  include <abstractions/dbus>

  unix peer=(addr=@mbim-proxy),

  /opt/fcc_lenovo/DPR_Fcc_unlock_service mr,
  /opt/fcc_lenovo/lib/*.so mrix,
  /usr/bin/cut ix,
  /usr/bin/dash ix,
  /usr/bin/grep ix,
  /usr/bin/ls ix,
  /usr/bin/lspci Cx,
  /usr/bin/lsusb Cx,
  /usr/bin/mmcli ix,
  /usr/bin/ps Cx -> ps,
  /usr/sbin/dmidecode Cx,
  /usr/libexec/mbim-proxy mrix,

  owner /dev/ r,
  owner /dev/wwan0at0 rw,
  owner /dev/wwan0mbim0 rw,
  owner /sys/bus/pci/devices/ r,
  owner /sys/devices/pci0000:00/** r,
  owner /sys/devices/virtual/dmi/id/product_family r,
  owner /sys/devices/virtual/dmi/id/product_name r,
  owner /sys/firmware/dmi/tables/DMI r,
  owner /sys/firmware/dmi/tables/smbios_entry_point r,
  owner /var/log/fcclock.err w,
  owner /var/log/fcclock.log w,


  profile /usr/bin/lspci {
    include <abstractions/base>

    capability dac_override,
    capability dac_read_search,
    capability sys_admin,

    deny owner /etc/nsswitch.conf r,
    deny owner /etc/passwd r,

    /sys/bus/pci/devices/ r,
    /sys/devices/** r,
    /usr/bin/lspci mr,
    /usr/share/misc/pci.ids r,

  }

  profile /usr/bin/lsusb flags=(complain) {
    include <abstractions/base>
    /usr/bin/lsusb mr,
  }

  profile /usr/sbin/dmidecode {
    include <abstractions/base>

    /dev/mem r,
    /sys/firmware/dmi/tables** r,
    /sys/firmware/efi/systab r,
    /usr/sbin/dmidecode mr,

  }

  profile ps {
    include <abstractions/base>
    include <abstractions/nameservice>

    # GH: #3079
    capability dac_override,
    capability dac_read_search,

    capability sys_ptrace,

    # GH: #3119
    ptrace (read,trace),

    # LP: #2067319
    /usr/bin/ps mrix,

    /dev/tty r,

    @{PROC}/ r,
    @{PROC}/@{pid}/** r,
    @{PROC}/uptime r,
    @{PROC}/sys/kernel/** r,
    # GH: #3079
    @{PROC}/tty/drivers r,
    /sys/devices/system/node/ r,
    /sys/devices/system/node/** r,

  }
}
